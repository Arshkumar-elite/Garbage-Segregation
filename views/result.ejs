<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Result - EcoVerse</title>
</head>
<body>
  <h1>Generated Image</h1>
  <img src="<%= imageUrl %>" alt="Annotated Result" style="max-width: 100%; height: auto;" />
  <h2>Detections:</h2>
  <ul>
    <% detections.forEach(d => { %>
      <li>
        <strong><%= d.name %></strong> - <%= d.type %> (<%= (d.confidence * 100).toFixed(1) %>%)
      </li>
    <% }) %>
  </ul>
  <a href="/">Upload another image</a>

  <script>
    const imageId = '<%= imageId %>';  // ID passed from server
    window.addEventListener('beforeunload', async () => {
      try {
        await fetch('/delete-image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ imageId })
        });
      } catch (error) {
        console.error('Deletion failed:', error);
      }
    });
  </script>
</body>
</html>
